# - type: elasticsearch.sequence
#   id: attacker.foothold.wordpress.crack
#   labels:
#     - attacker_change_user
#     - escalate
#   description: >-
#     This rule labels the user escalation events created by the attacker
#     using john the ripper to crack the wordpress credentials collected
#     from the database.
#   index:
#     - audit-intranet_server
#   # we use the auditd sequence as tiebreaker for identical timestamps
#   tiebreaker_field: auditd.log.sequence
#   filter:
#     range:
#       "@timestamp":
#         # escalation phase start
#         gte: "2021-10-04T12:53:47+00:00"
#         # escalation phase stop
#         lte: "2021-10-04T12:54:42+00:00"
# 


- type: elasticsearch.query
  id: attacker.dirb.time
  labels: [dirb]
  description: >-
    This labels attacker http traffic within the recorded dirb execution
    time with dirb.
  index:
    - apache_access-intranet_server
    - apache_error-intranet_server
  # obligatory match all
  query:
    match_all: {}
  filter:
    - range:
        "@timestamp":
          # dirb phase start
          gte: "{{ ( foothold.dirb_scan.start | as_datetime).replace(microsecond=0).isoformat() }}"
          # dirb phase stop
          lte: "{{ (foothold.dirb_scan.stop | as_datetime).isoformat() }}"

