filter {
    if [type] == "kyoushi" {
        if [event] {
            # cr-kyoushi-simulation <= 0.3.7 logs the messages in the `event` field
            # so we need to rename it to message to be able to use the event field
            # for ecs conform information (e.g., event.category etc.)
            mutate {
                rename => ["event", "message" ]
            }
        }

        if ![@metadata][kyoushi][sm] {
            # add a default sm type field
            mutate { add_field => { "[@metadata][kyoushi][sm]" => "sm" } }
        }

        if [current_state] {
            
            mutate {
                add_field => {
                    # set event category to <sm type>_<state>
                    "[event][category]" => "%{[@metadata][kyoushi][sm]}_%{current_state}"
                    "[event][action]" => "%{transition}"

                }
            }

        } else {
            mutate {
                add_field => {
                        # set event category to <sm type>.<state>
                        "[event][category]" => "%{[@metadata][kyoushi][sm]}"
                }
            }
        }

        date {
            # update the event timestamp to the correct recorded value
            match => ["timestamp", "UNIX", "ISO8601"]
            timezone => "%{[@metadata][event][timezone]}"
            remove_field => "timestamp"
        }   
    }
}